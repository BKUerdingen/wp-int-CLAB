version: "3.9"

services:

  mariadb:
    image: mariadb:11
    container_name: mariadb
    restart: always
    env_file:
      - ./.env
    volumes:
      - mariadb:/var/lib/mysql
    networks:
      - internal



  wordpress:
    image: wordpress:latest
    container_name: wordpress
    restart: always
    depends_on:
      - mariadb
    env_file:
      - ./.env
    environment:
      WORDPRESS_DB_HOST: mariadb
      WORDPRESS_DB_USER: ${MYSQL_USER}
      WORDPRESS_DB_PASSWORD: ${MYSQL_PASSWORD}
      WORDPRESS_DB_NAME: ${MYSQL_DATABASE}
    volumes:
      - wordpress:/var/www/html
    networks:
      - internal
      - proxy
    labels:
      - "traefik.enable=false"



  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    restart: always
    depends_on:
      - mariadb
    env_file:
      - ./.env
    environment:
      PMA_HOST: mariadb
      PMA_USER: ${MYSQL_USER}
      PMA_PASSWORD: ${MYSQL_PASSWORD}
    networks:
      - internal
      - proxy
    labels:
      - "traefik.enable=false"



  nginx_proxy_manager:
    image: jc21/nginx-proxy-manager:latest
    container_name: nginx-proxy-manager
    restart: always
    depends_on:
      - mariadb
    ports:
      - "${HTTP_PORT}:80"
      - "${NPM_UI_PORT}:81"
      - "${HTTPS_PORT}:443"
    env_file:
      - ./.env
    environment:
      DB_MYSQL_HOST: mariadb
      DB_MYSQL_PORT: ${MYSQL_PORT}
      DB_MYSQL_USER: ${MYSQL_USER}
      DB_MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      DB_MYSQL_NAME: ${MYSQL_DATABASE}
    volumes:
      - npm_data:/data
      - npm_letsencrypt:/etc/letsencrypt
    networks:
      - proxy
      - internal



  # -------------------------
  # ✅ WIKI.JS
  # -------------------------
  wikijs:
    image: ghcr.io/requarks/wiki:2
    container_name: wikijs
    restart: always
    depends_on:
      - mariadb
    env_file:
      - ./.env
    environment:
      DB_TYPE: mariadb
      DB_HOST: mariadb
      DB_PORT: 3306
      DB_USER: ${WIKI_DB_USER}
      DB_PASS: ${WIKI_DB_PASSWORD}
      DB_NAME: ${WIKI_DB_NAME}
    volumes:
      - wiki_data:/wiki/data
    networks:
      - internal
      - proxy



  # -------------------------
  # ✅ GRAFANA
  # -------------------------
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    restart: always
    depends_on:
      - mariadb
    env_file:
      - ./.env
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - internal
      - proxy



volumes:
  mariadb:
  wordpress:
  npm_data:
  npm_letsencrypt:
  wiki_data:
  grafana_data:



networks:
  internal:
    driver: bridge
  proxy:
    driver: bridge
